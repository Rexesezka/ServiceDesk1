# Описание основных компонентов проекта

## Основные компоненты фронтенда включают:

### HomePage (Файл: frontend/src/app/page.js)
Компонент страницы авторизации. Отображает форму входа с полями для email и пароля. При отправке формы данные передаются через fetch на эндпоинт `/api/auth/login/`. После успешной авторизации данные пользователя сохраняются в localStorage, и происходит перенаправление на страницу профиля. Компонент также проверяет наличие сохраненных данных пользователя при загрузке и автоматически перенаправляет авторизованных пользователей.

### CreateRequestPage (Файл: frontend/src/app/(main)/requests/create/page.js)
Компонент для создания новой заявки. Содержит форму с полями для выбора приоритета, типа поломки, адреса офиса, описания локации и проблемы. Поддерживает загрузку нескольких изображений с предпросмотром. При отправке формы данные передаются через FormData на эндпоинт `/api/requests/create/`. Компонент использует react-hook-form для управления формой и валидации данных. Автоматически подставляет офис пользователя из localStorage при загрузке.

### RequestsPage (Файл: frontend/src/app/(main)/requests/page.js)
Компонент для отображения списка заявок в виде канбан-доски. Поддерживает различные конфигурации колонок в зависимости от роли пользователя (сотрудник или АХО). Для сотрудников АХО доступна функция перетаскивания заявок между колонками для изменения статуса. Компонент загружает заявки с сервера через эндпоинт `/api/requests/<user_id>/` и поддерживает фильтрацию (мои заявки / я исполнитель). При клике на заявку открывается модальное окно с детальной информацией.

### RequestCard (Файл: frontend/src/components/ui/RequestCard/RequestCard.js)
Компонент карточки заявки для отображения в списке. Отображает ID заявки, приоритет, локацию, тип поломки и дату создания. Поддерживает drag-and-drop функционал для перемещения между колонками (только для сотрудников АХО). Форматирует дату в читаемый формат и применяет стили в зависимости от приоритета и статуса заявки.

### RequestViewModal (Файл: frontend/src/components/ui/RequestViewModal/RequestViewModal.js)
Модальное окно для просмотра и редактирования детальной информации о заявке. Отображает все поля заявки: приоритет, адрес, место сотрудника, тип поломки, описание локации и проблемы, исполнителя, затраты и комментарии. Для сотрудников АХО доступен режим редактирования с возможностью изменения всех полей, назначения исполнителя и обновления статуса заявки. Автоматически сохраняет изменения при закрытии модального окна. Поддерживает отображение прикрепленных изображений.

### NotificationModal (Файл: frontend/src/components/ui/NotificationModal/NotificationModal.js)
Компонент модального окна для отображения уведомлений пользователю. Поддерживает различные типы уведомлений (error, success, info, warning) с соответствующими иконками. Автоматически закрывается через 5 секунд после открытия. Может быть закрыт пользователем вручную.

### InputField (Файл: frontend/src/components/ui/InputField/InputField.js)
Переиспользуемый компонент поля ввода с поддержкой различных типов (text, email, password и др.). Для полей типа password включает функционал показа/скрытия пароля с помощью иконки. Поддерживает валидацию через атрибут required и кастомные обработчики изменения значения.

### UserAuthContext (Файл: frontend/src/context/UserAuthContext.js)
Контекст для управления состоянием аутентификации пользователя. Хранит данные пользователя в localStorage и предоставляет функции для обновления и выхода. Определяет роль пользователя (сотрудник или АХО) на основе данных из профиля. Предоставляет хуки для проверки прав доступа и получения информации о текущем пользователе.

### NotificationsContext (Файл: frontend/src/context/NotificationsContext.js)
Контекст для управления уведомлениями пользователя. Загружает уведомления с сервера через эндпоинт `/api/notifications/<user_id>/` и автоматически обновляет их каждые 30 секунд. Предоставляет функции для пометки уведомлений как прочитанных через эндпоинт `/api/notifications/<notification_id>/read/`. Поддерживает отображение всплывающих уведомлений через NotificationModal.

## Основные компоненты бэкенда включают:

### models.py (Файл: backend/backend/back/models.py)
Файл содержит модели данных Django ORM:
- **User**: модель пользователя с полями для авторизации (email, password, username), личной информации (ФИО, дата рождения, должность, роль) и связями с офисом и руководителем. Включает методы для хеширования и проверки пароля.
- **Office**: модель офиса с информацией о регионе, городе, адресе и иерархической структурой (родительский офис).
- **Request**: модель заявки с полями для описания проблемы, типа поломки, приоритета, локации, статуса и связями с пользователем, исполнителем и офисом.
- **Notification**: модель уведомлений с полями для сообщения, статуса прочтения и связями с пользователем и заявкой.
- **RequestAttachment**: модель для хранения вложений к заявкам (изображения).
- **TypeOfFailure**, **Status**, **Table**, **Comment**, **Load**: вспомогательные модели для типов поломок, статусов, затрат, комментариев и загрузки сотрудников.

### views.py (Файл: backend/backend/back/views.py)
Файл содержит API endpoints для обработки запросов от фронтенда:
- **login(request)**: обрабатывает POST-запросы для аутентификации пользователя. Проверяет email и пароль, возвращает данные пользователя в формате JSON.
- **get_profile(request, user_id)**: обрабатывает GET-запросы для получения профиля пользователя по ID.
- **upload_avatar(request, user_id)**: обрабатывает POST-запросы для загрузки аватара пользователя с валидацией типа и размера файла.
- **get_users(request)**: возвращает список пользователей с возможностью фильтрации по роли.
- **create_request(request)**: обрабатывает POST-запросы для создания новой заявки. Валидирует данные, создает заявку в БД, автоматически назначает исполнителя (сотрудника АХО) на основе загрузки и офиса, обрабатывает загрузку изображений и создает уведомление.
- **get_requests(request, user_id)**: возвращает список заявок пользователя с поддержкой фильтрации (мои заявки / я исполнитель). Преобразует данные из БД в формат, понятный фронтенду.
- **get_archive_requests(request)**: возвращает все выполненные заявки (архив) с поддержкой фильтрации по региону, городу и офису.
- **update_request(request, request_id)**: обрабатывает PATCH/PUT-запросы для обновления данных заявки. Доступно только для сотрудников АХО.
- **update_request_status(request, request_id)**: обрабатывает PATCH-запросы для изменения статуса заявки. Обновляет загрузку исполнителя при завершении заявки и создает уведомления.
- **get_notifications(request, user_id)**: возвращает список уведомлений пользователя.
- **mark_notification_read(request, notification_id)**: помечает уведомление как прочитанное.
- **get_office_filters(request)**: возвращает списки регионов, городов и офисов для фильтров в архиве.
- **find_best_performer(office, urgency)**: вспомогательная функция для автоматического выбора исполнителя на основе офиса и загрузки сотрудников АХО.

### urls.py (Файл: backend/backend/backend/urls.py)
Файл определяет маршруты (URL) для бэкенда:
- `api/auth/login/` → login: маршрут для аутентификации пользователя
- `api/user/profile/<user_id>/` → get_profile: маршрут для получения профиля пользователя
- `api/user/avatar/<user_id>/` → upload_avatar: маршрут для загрузки аватара
- `api/users/` → get_users: маршрут для получения списка пользователей
- `api/requests/create/` → create_request: маршрут для создания заявки
- `api/requests/<user_id>/` → get_requests: маршрут для получения списка заявок пользователя
- `api/requests/archive/` → get_archive_requests: маршрут для получения архива заявок
- `api/requests/<request_id>/update/` → update_request: маршрут для обновления заявки
- `api/requests/<request_id>/status/` → update_request_status: маршрут для изменения статуса заявки
- `api/offices/filters/` → get_office_filters: маршрут для получения фильтров офисов
- `api/notifications/<user_id>/` → get_notifications: маршрут для получения уведомлений
- `api/notifications/<notification_id>/read/` → mark_notification_read: маршрут для пометки уведомления как прочитанного
